
&НаКлиенте
Процедура КартинкаНажатие(Элемент, СтандартнаяОбработка)
	
	АдресВХранилище   = "";
	ВыбранноеИмяФайла = "";
	Если ПоместитьФайл(АдресВХранилище, , ВыбранноеИмяФайла, , УникальныйИдентификатор) Тогда 
		Файл = Новый Файл(ВыбранноеИмяФайла);
		СсылкаКартинкаВремХранБольшая = АдресВХранилище;
		Модифицированность = Истина;
		Записать();
	КонецЕсли;
	АдресКартинкиБольшая = ПолучитьНавСсылкуКартинкиБольшая();
	СтандартнаяОбработка = Ложь;
	
КонецПроцедуры

&НаСервере
Процедура ПрисоединитьФотоСерверБольшое(Адрес)
	
	Если ЗначениеЗаполнено(Объект.Ссылка) Тогда 
		Спр = РеквизитФормыВЗначение("Объект");
		Карт = Новый Картинка(Адрес);
		Спр.ФайлКартинкиБольшой = Новый ХранилищеЗначения(Карт);
		Спр.Записать();
		ЗначениеВРеквизитФормы(Спр, "Объект");
	Иначе
		Сообщение = Новый СообщениеПользователю;
		Сообщение.Текст = "Для присоединения фотографии запишите элемент справочника";
		Сообщение.Сообщить();
	КонецЕсли;
	
КонецПроцедуры

&НаСервере
Процедура ПрисоединитьФотоСерверМаленькое(Адрес)
	
	Если ЗначениеЗаполнено(Объект.Ссылка) Тогда 
		Спр = РеквизитФормыВЗначение("Объект");
		Карт = Новый Картинка(Адрес);
		Спр.ФайлКартинкиМаленький = Новый ХранилищеЗначения(Карт);
		Спр.Записать();
		ЗначениеВРеквизитФормы(Спр, "Объект");
	Иначе
		Сообщение = Новый СообщениеПользователю;
		Сообщение.Текст = "Для присоединения фотографии запишите элемент справочника";
		Сообщение.Сообщить();
	КонецЕсли;
	
КонецПроцедуры

&НаСервере
Функция   ПолучитьНавСсылкуКартинкиБольшая()
	
	СпрСсылка = РеквизитФормыВЗначение("Объект");
	
	Если ЗначениеЗаполнено(СпрСсылка.ФайлКартинкиБольшой) Тогда
		ДвоичныеДанные = СпрСсылка.ФайлКартинкиБольшой.Получить();
		АдресКартинки = ПоместитьВоВременноеХранилище(ДвоичныеДанные, УникальныйИдентификатор);
	Иначе
		АдресКартинки = "";
	Конецесли;
	
	Возврат АдресКартинки;
	
КонецФункции

&НаСервере
Функция   ПолучитьНавСсылкуКартинкиМаленькая()
	
	СпрСсылка = РеквизитФормыВЗначение("Объект");
	
	Если ЗначениеЗаполнено(СпрСсылка.ФайлКартинкиМаленький) Тогда
		ДвоичныеДанные = СпрСсылка.ФайлКартинкиМаленький.Получить();
		АдресКартинки = ПоместитьВоВременноеХранилище(ДвоичныеДанные, УникальныйИдентификатор);
	Иначе
		АдресКартинки = "";
	Конецесли;
	
	Возврат АдресКартинки;
	
КонецФункции

&НаСервере
Процедура ПриСозданииНаСервере(Отказ, СтандартнаяОбработка)
	
	Если ЗначениеЗаполнено(Объект.Ссылка) Тогда
		АдресКартинкиБольшая   = ПолучитьНавСсылкуКартинкиБольшая();
		АдресКартинкиМаленькая = ПолучитьНавСсылкуКартинкиМаленькая();
	КонецЕсли;
	
КонецПроцедуры

&НаСервере
Процедура ЗаполнитьПоФизЛицуСервер()
	
	СпрСсылка = РеквизитФормыВЗначение("Объект");
	СпрСсылка.Наименование = СпрСсылка.ФизическоеЛицо.Наименование;
	
	Запрос = Новый Запрос;
	Запрос.Текст = "ВЫБРАТЬ
	|	ПаспортныеДанныеФизЛицСрезПоследних.ДокументВид,
	|	ПаспортныеДанныеФизЛицСрезПоследних.ДокументСерия,
	|	ПаспортныеДанныеФизЛицСрезПоследних.ДокументНомер,
	|	ПаспортныеДанныеФизЛицСрезПоследних.ДокументДатаВыдачи,
	|	ПаспортныеДанныеФизЛицСрезПоследних.ДокументКемВыдан,
	|	ПаспортныеДанныеФизЛицСрезПоследних.ДокументКодПодразделения,
	|	ПаспортныеДанныеФизЛицСрезПоследних.ДатаРегистрацииПоМестуЖительства
	|ИЗ
	|	РегистрСведений.ПаспортныеДанныеФизЛиц.СрезПоследних(
	|			,
	|			ФизЛицо = &ФизЛицо
	|				И ДокументВид = &ДокументВид) КАК ПаспортныеДанныеФизЛицСрезПоследних";
	
	Запрос.УстановитьПараметр("ФизЛицо", СпрСсылка.ФизическоеЛицо);
	Запрос.УстановитьПараметр("ДокументВид", _Кирилл.ПолучитьЗначениеПараметра("ВидДокументаПаспорт"));
	
	Результат = Запрос.Выполнить();
	Выборка = Результат.Выбрать();
	Пока Выборка.Следующий() Цикл
		СпрСсылка.ПаспортНомер = Выборка.ДокументСерия + " " + Выборка.ДокументНомер;
		СпрСсылка.ПаспортВыданДата = Выборка.ДокументДатаВыдачи;
		СпрСсылка.ПаспортВыданКем = Выборка.ДокументКемВыдан;
	КонецЦикла;
	
	ЗначениеВРеквизитФормы(СпрСсылка, "Объект");
	
КонецПроцедуры

&НаКлиенте
Процедура ФизическоеЛицоПриИзменении(Элемент)
	
	ЗаполнитьПоФизЛицуСервер();

	ПолучитьНавСсылкуКартинкиБольшая();
	ПолучитьНавСсылкуКартинкиМаленькая();
	
КонецПроцедуры

&НаСервере
Процедура ПередЗаписьюНаСервере(Отказ, ТекущийОбъект, ПараметрыЗаписи)
	
	Если ЭтоАдресВременногоХранилища(СсылкаКартинкаВремХранБольшая) Тогда 
		ДвоичныеДанные = ПолучитьИзВременногоХранилища(СсылкаКартинкаВремХранБольшая);
		ТекущийОбъект.ФайлКартинкиБольшой = Новый ХранилищеЗначения(ДвоичныеДанные, Новый СжатиеДанных(9));
	КонецЕсли;
	
	Если ЭтоАдресВременногоХранилища(СсылкаКартинкаВремХранМаленькая) Тогда 
		ДвоичныеДанные = ПолучитьИзВременногоХранилища(СсылкаКартинкаВремХранМаленькая);
		ТекущийОбъект.ФайлКартинкиМаленький = Новый ХранилищеЗначения(ДвоичныеДанные, Новый СжатиеДанных(9));
	КонецЕсли;
		
КонецПроцедуры


&НаКлиенте
Процедура КартинкаМаленькаяНажатие(Элемент, СтандартнаяОбработка)
	
	АдресВХранилище   = "";
	ВыбранноеИмяФайла = "";
	Если ПоместитьФайл(АдресВХранилище, , ВыбранноеИмяФайла, , УникальныйИдентификатор) Тогда 
		Файл = Новый Файл(ВыбранноеИмяФайла);
		СсылкаКартинкаВремХранМаленькая = АдресВХранилище;
		Модифицированность = Истина;
		Записать();
	КонецЕсли;
	АдресКартинкиМаленькая = ПолучитьНавСсылкуКартинкиМаленькая();
	СтандартнаяОбработка = Ложь;
	
КонецПроцедуры

