
&НаСервере
Процедура ПрисоединитьФотоСерверБольшое(Адрес)
	
	Если ЗначениеЗаполнено(Объект.Ссылка) Тогда 
		Спр = РеквизитФормыВЗначение("Объект");
		Карт = Новый Картинка(Адрес);
		Спр.ФайлКартинкиБольшой = Новый ХранилищеЗначения(Карт);
		Спр.Записать();
		ЗначениеВРеквизитФормы(Спр, "Объект");
	Иначе
		Сообщение = Новый СообщениеПользователю;
		Сообщение.Текст = "Для присоединения фотографии запишите элемент справочника";
		Сообщение.Сообщить();
	КонецЕсли;
	
КонецПроцедуры

&НаСервере
Процедура ПрисоединитьФотоСерверМаленькое(Адрес)
	
	Если ЗначениеЗаполнено(Объект.Ссылка) Тогда 
		Спр = РеквизитФормыВЗначение("Объект");
		Карт = Новый Картинка(Адрес);
		Спр.ФайлКартинкиМаленький = Новый ХранилищеЗначения(Карт);
		Спр.Записать();
		ЗначениеВРеквизитФормы(Спр, "Объект");
	Иначе
		Сообщение = Новый СообщениеПользователю;
		Сообщение.Текст = "Для присоединения фотографии запишите элемент справочника";
		Сообщение.Сообщить();
	КонецЕсли;
	
КонецПроцедуры

&НаКлиенте
Процедура ДобавитьФотоБольшое(Команда)
	
	Режим = РежимДиалогаВыбораФайла.Открытие;
	ДиалогОткрытияФайла = Новый ДиалогВыбораФайла(Режим);
	ДиалогОткрытияФайла.ПолноеИмяФайла = "";
	Текст = "ru = ""Текст""; en = ""Text""";
	Фильтр = НСтр(Текст)+"(*.jpg)|*.jpg";
	ДиалогОткрытияФайла.Фильтр = Фильтр;
	ДиалогОткрытияФайла.МножественныйВыбор = Истина;
	ДиалогОткрытияФайла.Заголовок = "Выберите файлы";
	Если ДиалогОткрытияФайла.Выбрать() Тогда
		МассивФайлов = ДиалогОткрытияФайла.ВыбранныеФайлы;
		Для Каждого Файл Из МассивФайлов Цикл
			ПрисоединитьФотоСерверБольшое(Файл);
			Прервать;
		КонецЦикла;
	Иначе
		Текст = "ru = ""Файл(ы) не выбран!""; en = ""File(s) not selected!""";
		Предупреждение(НСтр(Текст));
	КонецЕсли;
	
	АдресКартинкиБольшая = ПолучитьНавСсылкуКартинкиБольшая();
	
КонецПроцедуры 

&НаКлиенте
Процедура ДобавитьФотоМаленькое(Команда)
	
	Режим = РежимДиалогаВыбораФайла.Открытие;
	ДиалогОткрытияФайла = Новый ДиалогВыбораФайла(Режим);
	ДиалогОткрытияФайла.ПолноеИмяФайла = "";
	Текст = "ru = ""Текст""; en = ""Text""";
	Фильтр = НСтр(Текст)+"(*.jpg)|*.jpg";
	ДиалогОткрытияФайла.Фильтр = Фильтр;
	ДиалогОткрытияФайла.МножественныйВыбор = Истина;
	ДиалогОткрытияФайла.Заголовок = "Выберите файлы";
	Если ДиалогОткрытияФайла.Выбрать() Тогда
		МассивФайлов = ДиалогОткрытияФайла.ВыбранныеФайлы;
		Для Каждого Файл Из МассивФайлов Цикл
			ПрисоединитьФотоСерверМаленькое(Файл);
			Прервать;
		КонецЦикла;
	Иначе
		Текст = "ru = ""Файл(ы) не выбран!""; en = ""File(s) not selected!""";
		Предупреждение(НСтр(Текст));
	КонецЕсли;
	
	АдресКартинкиМаленькая = ПолучитьНавСсылкуКартинкиМаленькая();

КонецПроцедуры

&НаСервере
Функция   ПолучитьНавСсылкуКартинкиБольшая()
	
	СпрСсылка = РеквизитФормыВЗначение("Объект");
	
	Если ЗначениеЗаполнено(СпрСсылка.ФайлКартинкиБольшой) Тогда
		ДвоичныеДанные = СпрСсылка.ФайлКартинкиБольшой.Получить();
		АдресКартинки = ПоместитьВоВременноеХранилище(ДвоичныеДанные, УникальныйИдентификатор);
	Иначе
		АдресКартинки = "";
	Конецесли;
	
	Возврат АдресКартинки;
	
КонецФункции

&НаСервере
Функция   ПолучитьНавСсылкуКартинкиМаленькая()
	
	СпрСсылка = РеквизитФормыВЗначение("Объект");
	
	Если ЗначениеЗаполнено(СпрСсылка.ФайлКартинкиМаленький) Тогда
		ДвоичныеДанные = СпрСсылка.ФайлКартинкиМаленький.Получить();
		АдресКартинки = ПоместитьВоВременноеХранилище(ДвоичныеДанные, УникальныйИдентификатор);
	Иначе
		АдресКартинки = "";
	Конецесли;
	
	Возврат АдресКартинки;
	
КонецФункции

&НаСервере
Процедура ПриСозданииНаСервере(Отказ, СтандартнаяОбработка)
	
	Если ЗначениеЗаполнено(Объект.Ссылка) Тогда
		АдресКартинкиБольшая   = ПолучитьНавСсылкуКартинкиБольшая();
		АдресКартинкиМаленькая = ПолучитьНавСсылкуКартинкиМаленькая();
	КонецЕсли;

КонецПроцедуры





