
&НаСервере
Функция   Печать(СсылкаНаОбъект) Экспорт
	
	ТабДок = Новый ТабличныйДокумент;
	Макет = Документы._ГарантийныйЗапрос.ПолучитьМакет("АктРекламация");
	
	ОблШапка  = Макет.ПолучитьОбласть("Шапка");
	ОблСтрока = Макет.ПолучитьОбласть("Строка");
	ОблПодвал = Макет.ПолучитьОбласть("Подвал");
	
	ОблШапка.Параметры.ЗаголовокДокумента = "Акт-рекламация №" + СокрЛП(СсылкаНаОбъект.Номер) + " от: " + Формат(СсылкаНаОбъект.Дата, "ДФ=dd.MM.yyyy");
	
	ОблШапка.Параметры.АдресПотребителя = СсылкаНаОбъект.Рекламация_Адрес;
	Если ЗначениеЗаполнено(СсылкаНаОбъект.Дилер) Тогда 
		ОблШапка.Параметры.НаименованиеПотребителя = СсылкаНаОбъект.Дилер.НаименованиеПолное;
	КонецЕсли;
	ОблШапка.Параметры.РекламацияСоставлена    = СсылкаНаОбъект.Рекламация_Составлена;
	ОблШапка.Параметры.ПредставиельСЦ          = СсылкаНаОбъект.Рекламация_ПредставительСЦ;
	ОблШапка.Параметры.ПредставительВладельца  = СсылкаНаОбъект.Рекламация_ПредставительВладельца;
	Если ЗначениеЗаполнено(СсылкаНаОбъект.МодельМашины) Тогда 
		Попытка
			ОблШапка.Параметры.МаркаТехники        = СсылкаНаОбъект.МодельМашины.Код + "  " + СсылкаНаОбъект.МодельМашины.Наименование;
		Исключение
			ОблШапка.Параметры.МаркаТехники        = СсылкаНаОбъект.МодельМашины;	
		КонецПопытки;
	КонецЕсли;	
	ОблШапка.Параметры.Серийныйномер = СсылкаНаОбъект.СерийныйНомер; 
	ОблШапка.Параметры.ГодВыпуска    = СсылкаНаОбъект.ГодВыпуска;   
	
	ОблШапка.Параметры.ДатаОтгрузки = Формат(СсылкаНаОбъект.ДатаОтгрузки, "ДФ=dd.MM.yyyy");
	ОблШапка.Параметры.ДатаВвода    = Формат(СсылкаНаОбъект.ДатаОтгрузки, "ДФ=dd.MM.yyyy");
	ОблШапка.Параметры.ДатаПоломки  = Формат(СсылкаНаОбъект.ДатаПоломки, "ДФ=dd.MM.yyyy");
	
	ОблШапка.Параметры.Наработка                = СсылкаНаОбъект.Рекламация_ЧасовОтДатыВводаВЭксп;
	ОблШапка.Параметры.ПриРаботе                = СсылкаНаОбъект.Рекламация_ВидРаботы;
	ОблШапка.Параметры.ГСМ                      = СсылкаНаОбъект.Рекламация_ГСМ;
	ОблШапка.Параметры.ПоследнееТО              = СсылкаНаОбъект.Рекламация_ТОПоследнее;
	ОблШапка.Параметры.ДатаТО                   = СсылкаНаОбъект.Рекламация_ТоДата;
	ОблШапка.Параметры.НаработкаТО              = СсылкаНаОбъект.Рекламация_ТоНаработка;
	ОблШапка.Параметры.Неисправность            = СсылкаНаОбъект.НеисправностьОписание;
	ОблШапка.Параметры.НеисправностьПричина     = СсылкаНаОбъект.НеисправностьПричина;
	ОблШапка.Параметры.ТребуютсяРаботы          = СсылкаНаОбъект.Рекламация_Работы;
	ОблШапка.Параметры.ТребуетсяДопОбследование = СсылкаНаОбъект.Рекламация_ПровестиДопИсследование;
	
	ТабДок.Вывести(ОблШапка);
	
	Номер = 0;
	Для Каждого Строка Из СсылкаНаОбъект.Товары Цикл
		Попытка
			Номер = Номер + 1;
			ОблСтрока.Параметры.Номер        = Номер;
			
			//ОблСтрока.Параметры.Код          = Строка.Номенклатура.Код;
			//ОблСтрока.Параметры.Наименование = Строка.Номенклатура.Наименование + "/" + Строка.Номенклатура.НаименованиеПолное;
			Если ЗначениеЗаполнено(Строка.Номенклатура) Тогда 
				ОблСтрока.Параметры.Код          = Строка.Номенклатура.Код;
				ОблСтрока.Параметры.Наименование = Строка.Номенклатура.Наименование + "/" + Строка.Номенклатура.НаименованиеПолное;
			Иначе
				ОблСтрока.Параметры.Код          = "";
				ОблСтрока.Параметры.Наименование = Строка.ВнешнийКод;
			КонецЕсли;

			ОблСтрока.Параметры.Количество   = Строка.Количество;
			ТабДок.Вывести(ОблСтрока);
		Исключение
		КонецПопытки;
	КонецЦикла;
	
	ОблПодвал.Параметры.МашВостДата       = СсылкаНаОбъект.Рекламация_МашинаВосстановленаДата;
	ОблПодвал.Параметры.МашВостСилами     = СсылкаНаОбъект.Рекламация_МашинаВосстановленаКем;
	ОблПодвал.Параметры.МашВостМетодом    = СсылкаНаОбъект.Рекламация_МашинаВосстановленаМетодом;
	ОблПодвал.Параметры.ОсобыеЗамечания   = СсылкаНаОбъект.Рекламация_Замечания;
	ОблПодвал.Параметры.Выводы            = СсылкаНаОбъект.Рекламация_Результат;
	
	ТабДок.Вывести(ОблПодвал);
	
	ТабДок.АвтоМасштаб         = Истина;
	ТабДок.ОтображатьЗаголовки = Истина;
	ТабДок.ОтображатьСетку     = Ложь;
	
	Возврат ТабДок;
	
КонецФункции

&НаСервере
Функция   ПечатнаяФорма(ПараметрКоманды) Экспорт
	
	Отказ = Ложь;
	
	ТабДок = Печать(ПараметрКоманды);	
	
	Возврат ТабДок;
	
КонецФункции

&НаСервере
Функция   ПолучитьРеквНаСервере(ИмяРекв, Ссылка)
	
	Если       ИмяРекв = "Контр" Тогда
		Наименование = Ссылка.Дилер.НаименованиеПолное;
		Возврат СтрЗаменить(Наименование, Символ(34), "");
	ИначеЕсли  ИмяРекв = "Номер" Тогда
		Возврат СокрЛП(Ссылка.Номер);
	ИначеЕсли  ИмяРекв = "Дата" Тогда 
		Возврат Формат(Ссылка.Дата, "ДФ=dd.MM.yyyy");	
	КонецЕсли;
	
КонецФункции

&НаКлиенте
Процедура ОбработкаКоманды(ПараметрКоманды, ПараметрыВыполненияКоманды)
	
	ТабличныйДокумент = ПечатнаяФорма(ПараметрКоманды);
	
	Если НЕ ТабличныйДокумент = Неопределено Тогда
		Контр = ПолучитьРеквНаСервере("Контр", ПараметрКоманды);
		Номер = ПолучитьРеквНаСервере("Номер", ПараметрКоманды);
		Дата  = ПолучитьРеквНаСервере("Дата", ПараметрКоманды);
		ТабличныйДокумент.Показать("Акт рекламации " + Контр + " №" + Номер + " от " + Дата);
	КонецЕсли;	
	
КонецПроцедуры

