
&НаСервере
Функция   Печать(СсылкаНаОбъект) Экспорт
	
	ТабДок = Новый ТабличныйДокумент;
	Макет = Документы._ГарантийныйЗапрос.ПолучитьМакет("ГарантийноеПисьмо");
	
	ОблШапка = Макет.ПолучитьОбласть("Шапка");
	
	Если НЕ ТипЗнч(СсылкаНаОбъект.МодельМашины) = Тип("Строка") Тогда 
		Код = СсылкаНаОбъект.МодельМашины.Код;
	Иначе
		Код = "";
	КонецЕсли;
	
	ОблШапка.Параметры.ТекстПисьма = ?(ЗначениеЗаполнено(СсылкаНаОбъект.Дилер), СсылкаНаОбъект.Дилер.НаименованиеПолное, "<              >") + 
	" просит Вас заменить запасные части согласно гарантийному ремонту на " + ?(ЗначениеЗаполнено(СсылкаНаОбъект.МодельМашины), СокрЛП(СсылкаНаОбъект.МодельМашины), "") + 
	" артикул " + Код + " с.н. " + ?(ЗначениеЗаполнено(СсылкаНаОбъект.СерийныйНомер), СсылкаНаОбъект.СерийныйНомер, "") + 
	", отгруженный в наш в адрес  по товарной накладной " + СсылкаНаОбъект.НомерДокОтгрузки + " от " + Формат(СсылкаНаОбъект.ДатаОтгрузки, "ДФ=dd.MM.yyyy");
	
	ТабДок.Вывести(ОблШапка);
	ТабДок.АвтоМасштаб = Истина;
	
	Возврат ТабДок;
	
КонецФункции

&НаСервере
Функция   ПечатнаяФорма(ПараметрКоманды) Экспорт
	
	Отказ = Ложь;
	
	//Если ПараметрКоманды.Проведен Тогда 
		ТабДок = Печать(ПараметрКоманды);	
	//Иначе
	//	Сообщение = Новый СообщениеПользователю;
	//	Сообщение.Текст = "Невозможно распечатать непроведенный документ. " + Символы.ПС + "Проведите документ и повторите попытку";
	//	Сообщение.Сообщить();
	//	Возврат Неопределено
	//КонецЕсли;
	
	Возврат ТабДок;
	
КонецФункции

&НаСервере
Функция   ПолучитьРеквНаСервере(ИмяРекв, Ссылка)
	
	Если       ИмяРекв = "Контр" Тогда
		Наименование = Ссылка.Дилер.НаименованиеПолное;
		Возврат СтрЗаменить(Наименование, Символ(34), "");
	ИначеЕсли  ИмяРекв = "Номер" Тогда
		Возврат СокрЛП(Ссылка.Номер);
	ИначеЕсли  ИмяРекв = "Дата" Тогда 
		Возврат Формат(Ссылка.Дата, "ДФ=dd.MM.yyyy");	
	КонецЕсли;
	
КонецФункции

&НаКлиенте
Процедура ОбработкаКоманды(ПараметрКоманды, ПараметрыВыполненияКоманды)
	
	ТабличныйДокумент = ПечатнаяФорма(ПараметрКоманды);
	
	Если НЕ ТабличныйДокумент = Неопределено Тогда
		Контр = ПолучитьРеквНаСервере("Контр", ПараметрКоманды);
		Номер = ПолучитьРеквНаСервере("Номер", ПараметрКоманды);
		Дата  = ПолучитьРеквНаСервере("Дата", ПараметрКоманды);
		ТабличныйДокумент.Показать("Гарантийное письмо " + Контр + " №" + Номер + " от " + Дата);
	КонецЕсли;	
	
КонецПроцедуры

